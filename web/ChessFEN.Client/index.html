<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chess FEN Scanner</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>â™”</text></svg>">
    <link rel="stylesheet" href="styles.css?v=10">
</head>
<body>
    <div class="app">
        <!-- Main Content -->
        <main class="main">
            <!-- Image Input -->
            <section class="card card-compact" id="inputSection">
                <div class="input-options">
                    <button class="btn btn-primary" id="cameraBtn">
                        ğŸ“¸ Camera
                    </button>
                    <span class="or-divider">or</span>
                    <label class="btn btn-secondary file-label">
                        ğŸ“ File
                        <input type="file" id="fileInput" accept="image/*" hidden>
                    </label>
                    <button class="btn btn-success" id="analyzeBtn" disabled>
                        ğŸ” Analyze
                    </button>
                </div>
                <!-- Skip Detection Option -->
                <div class="skip-detection-row" id="optionsPanel" hidden>
                    <label class="checkbox-label">
                        <input type="checkbox" id="skipDetection">
                        <span>Skip board detection</span>
                    </label>
                </div>
                <!-- Hidden elements for state management -->
                <div id="previewContainer" hidden>
                    <img id="previewImage" alt="Board preview" style="display:none">
                    <button class="btn btn-icon btn-clear" id="clearBtn" title="Clear">âœ•</button>
                </div>
            </section>

            <!-- Loading State -->
            <section class="card loading-card" id="loadingSection" hidden>
                <div class="spinner"></div>
                <p id="loadingStatus">Analyzing board...</p>
                <div class="progress-stages" id="progressStages">
                    <span class="stage active" data-stage="detect">ğŸ” Detecting</span>
                    <span class="stage" data-stage="warp">ğŸ“ Warping</span>
                    <span class="stage" data-stage="classify">â™Ÿï¸ Classifying</span>
                    <span class="stage" data-stage="validate">âœ“ Validating</span>
                </div>
            </section>

            <!-- Results -->
            <section class="card" id="resultsSection" hidden>
                <!-- Position Status -->
                <div class="fen-container">
                    <div class="fen-status" id="fenStatus"></div>
                    <p class="fen-hint" id="fenHint" hidden>Inspect the board and edit if needed</p>
                </div>

                <!-- Board Display -->
                <div class="predicted-board-container">
                    <div class="board-wrapper">
                        <table class="chess-board" id="chessBoard"></table>
                    </div>
                    <div class="board-actions">
                        <button class="btn btn-sm btn-outline" id="editBoardBtn" title="Edit position">âœï¸ Edit</button>
                        <button class="btn btn-sm btn-outline" id="resetBoardBtn" title="Reset to original" hidden>â†©ï¸ Reset</button>
                    </div>
                </div>

                <!-- Piece Palette (for editing) -->
                <div class="piece-palette" id="piecePalette" hidden>
                    <div class="palette-row">
                        <span class="palette-piece" data-piece="wK">â™”</span>
                        <span class="palette-piece" data-piece="wQ">â™•</span>
                        <span class="palette-piece" data-piece="wR">â™–</span>
                        <span class="palette-piece" data-piece="wB">â™—</span>
                        <span class="palette-piece" data-piece="wN">â™˜</span>
                        <span class="palette-piece" data-piece="wP">â™™</span>
                    </div>
                    <div class="palette-row">
                        <span class="palette-piece" data-piece="bK">â™š</span>
                        <span class="palette-piece" data-piece="bQ">â™›</span>
                        <span class="palette-piece" data-piece="bR">â™œ</span>
                        <span class="palette-piece" data-piece="bB">â™</span>
                        <span class="palette-piece" data-piece="bN">â™</span>
                        <span class="palette-piece" data-piece="bP">â™Ÿ</span>
                    </div>
                    <div class="palette-row">
                        <span class="palette-piece selected" data-piece="empty">â¬œ</span>
                        <span class="palette-hint">Click piece, then click square</span>
                    </div>
                </div>

                <!-- Correction Notice -->
                <div class="correction-notice" id="correctionNotice" hidden>
                    <span class="correction-text">ğŸ“ <span id="correctionCount">0</span> corrections made</span>
                    <button class="btn btn-sm btn-success" id="submitCorrectionsBtn">âœ… Submit for Training</button>
                </div>

                <!-- Analyze on Chess.com -->
                <div class="search-section">
                    <h3>â™Ÿï¸ Analyze on Chess.com</h3>
                    <div class="search-buttons">
                        <a class="btn btn-analyze" id="analyzeWhiteBtn" target="_blank">
                            â¬œ White to Move
                        </a>
                        <a class="btn btn-analyze" id="analyzeBlackBtn" target="_blank">
                            â¬› Black to Move
                        </a>
                    </div>
                </div>

                <!-- Play on Chess.com -->
                <div class="search-section">
                    <h3>ğŸ® Play vs Computer on Chess.com</h3>
                    <div class="search-buttons">
                        <a class="btn btn-play" id="playWhiteBtn" target="_blank">
                            â¬œ Play as White
                        </a>
                        <a class="btn btn-play" id="playBlackBtn" target="_blank">
                            â¬› Play as Black
                        </a>
                    </div>
                </div>

                <!-- Chess.com Search -->
                <div class="search-section" id="findGamesSection">
                    <h3>ğŸ” Find Games on Chess.com</h3>
                    <div class="games-check-row">
                        <button class="btn btn-primary" id="checkGamesBtn">ğŸ” Search</button>
                        <div class="games-check-status" id="gamesCheckStatus" hidden>
                            <span class="checking-text">â³ Checking...</span>
                        </div>
                        <div class="games-found-icons" id="gamesFoundIcons" hidden>
                            <a class="game-found-icon white" id="whiteGameIcon" target="_blank" title="Games found with White to move">
                                <span class="icon">â™”</span>
                                <span class="label">White</span>
                            </a>
                            <a class="game-found-icon black" id="blackGameIcon" target="_blank" title="Games found with Black to move">
                                <span class="icon">â™š</span>
                                <span class="label">Black</span>
                            </a>
                        </div>
                        <div class="no-games-found" id="noGamesFound" hidden>
                            <span>No games found</span>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="result-actions">
                    <button class="btn btn-secondary" id="newScanBtn">
                        ğŸ”„ New Scan
                    </button>
                </div>
            </section>

            <!-- Error State -->
            <section class="card error-card" id="errorSection" hidden>
                <div class="error-icon">âš ï¸</div>
                <p id="errorMessage">An error occurred</p>
                <button class="btn btn-secondary" id="retryBtn">Try Again</button>
            </section>
        </main>

        <!-- Camera Modal -->
        <div class="modal" id="cameraModal" hidden>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ğŸ“¸ Capture Chess Board</h3>
                    <button class="btn btn-icon modal-close" id="closeCameraBtn">âœ•</button>
                </div>
                <div class="camera-container">
                    <video id="cameraVideo" autoplay playsinline muted></video>
                    <div class="camera-guide">
                        <div class="guide-square"></div>
                        <div class="guide-text">Align board here</div>
                    </div>
                </div>
                <div class="camera-status" id="cameraStatus">Initializing camera...</div>
                <div class="camera-controls">
                    <button class="btn btn-secondary" id="switchCameraBtn">ğŸ”„ Switch</button>
                    <button class="btn btn-success btn-large" id="captureBtn" disabled>ğŸ“· Capture</button>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast" hidden></div>

        <!-- FAQ Section -->
        <section class="card faq-section">
            <h3>FAQ</h3>
            <details>
                <summary>I get "board not detected"</summary>
                <p>Make sure the lighting is good and the image is as sharp as possible. If it still doesn't work, try cropping the image along the edges of the board and select "Skip board detection".</p>
            </details>
            <details>
                <summary>I get question marks on the resulting board</summary>
                <p>Question marks indicate uncertain predictions. Check against your image and edit the board if needed.</p>
            </details>
            <details>
                <summary>The game does not exist on Chess.com</summary>
                <p>Some games are not uploaded to Chess.com, though most should be available.</p>
            </details>
            <details>
                <summary>Why can I analyze or play as both white and black?</summary>
                <p>The position comes with whose turn it is, but sometimes playing from the other side can be a learning experience as well.</p>
            </details>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="version-info" id="versionInfo">Loading version...</div>
            <a href="admin.html" class="admin-link" id="adminLink" style="display: none;">Admin Dashboard</a>
        </footer>
    </div>

    <script src="config.js?v=10"></script>
    <script src="app.js?v=10"></script>
</body>
</html>
