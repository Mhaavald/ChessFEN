<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chess FEN Scanner</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>â™”</text></svg>">
    <link rel="stylesheet" href="styles.css?v=6">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <h1>â™” Chess FEN Scanner</h1>
            <p class="subtitle">Scan a chess position, get the FEN, find games</p>
            <a href="admin.html" class="admin-link" id="adminLink" style="display: none;">Admin Dashboard</a>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Step 1: Image Input -->
            <section class="card" id="inputSection">
                <h2>1. Capture or Upload Board Image</h2>
                
                <div class="input-options">
                    <button class="btn btn-primary btn-large" id="cameraBtn">
                        ğŸ“¸ Open Camera
                    </button>
                    <span class="or-divider">or</span>
                    <label class="btn btn-secondary btn-large file-label">
                        ğŸ“ Choose File
                        <input type="file" id="fileInput" accept="image/*" hidden>
                    </label>
                </div>

                <!-- Image Preview -->
                <div class="preview-container" id="previewContainer" hidden>
                    <img id="previewImage" alt="Board preview">
                    <button class="btn btn-icon btn-clear" id="clearBtn" title="Clear">âœ•</button>
                </div>

                <!-- Options -->
                <div class="options" id="optionsPanel" hidden>
                    <label class="checkbox-label">
                        <input type="checkbox" id="skipDetection">
                        <span>Image is board only (skip detection)</span>
                    </label>
                    <div class="model-select">
                        <label for="modelSelect">Model:</label>
                        <select id="modelSelect">
                            <option value="">Default (ResNet18)</option>
                        </select>
                    </div>
                </div>

                <!-- Analyze Buttons -->
                <div class="analyze-buttons">
                    <button class="btn btn-success btn-large" id="analyzeBtn" disabled>
                        ğŸ” Quick Analyze
                    </button>
                    <button class="btn btn-primary btn-large" id="deepAnalyzeBtn" disabled>
                        ğŸ”¬ Deep Analysis
                    </button>
                </div>
                <p class="hint">Deep Analysis uses all models and checks Chess.com for games</p>
            </section>

            <!-- Loading State -->
            <section class="card loading-card" id="loadingSection" hidden>
                <div class="spinner"></div>
                <p id="loadingStatus">Analyzing board...</p>
                <div class="progress-stages" id="progressStages">
                    <span class="stage active" data-stage="detect">ğŸ” Detecting</span>
                    <span class="stage" data-stage="warp">ğŸ“ Warping</span>
                    <span class="stage" data-stage="classify">â™Ÿï¸ Classifying</span>
                    <span class="stage" data-stage="validate">âœ“ Validating</span>
                </div>
            </section>

            <!-- Step 2: Results -->
            <section class="card" id="resultsSection" hidden>
                <h2>2. Results</h2>

                <!-- Boards side by side -->
                <div class="boards-row">
                    <!-- Captured Board Image -->
                    <div class="captured-board-container" id="capturedBoardContainer" hidden>
                        <h3>ğŸ“¸ Captured</h3>
                        <img id="capturedBoardImage" alt="Captured board" class="captured-board-image">
                    </div>

                    <!-- Board Display -->
                    <div class="predicted-board-container">
                        <h3 id="predictedBoardTitle" hidden>â™Ÿï¸ Predicted</h3>
                        <div class="board-wrapper">
                            <table class="chess-board" id="chessBoard"></table>
                        </div>
                        <div class="board-actions">
                            <button class="btn btn-sm btn-outline" id="editBoardBtn" title="Edit position">âœï¸ Edit</button>
                            <button class="btn btn-sm btn-outline" id="resetBoardBtn" title="Reset to original" hidden>â†©ï¸ Reset</button>
                        </div>
                    </div>
                </div>

                <!-- Piece Palette (for editing) -->
                <div class="piece-palette" id="piecePalette" hidden>
                    <div class="palette-row">
                        <span class="palette-piece" data-piece="wK">â™”</span>
                        <span class="palette-piece" data-piece="wQ">â™•</span>
                        <span class="palette-piece" data-piece="wR">â™–</span>
                        <span class="palette-piece" data-piece="wB">â™—</span>
                        <span class="palette-piece" data-piece="wN">â™˜</span>
                        <span class="palette-piece" data-piece="wP">â™™</span>
                    </div>
                    <div class="palette-row">
                        <span class="palette-piece" data-piece="bK">â™š</span>
                        <span class="palette-piece" data-piece="bQ">â™›</span>
                        <span class="palette-piece" data-piece="bR">â™œ</span>
                        <span class="palette-piece" data-piece="bB">â™</span>
                        <span class="palette-piece" data-piece="bN">â™</span>
                        <span class="palette-piece" data-piece="bP">â™Ÿ</span>
                    </div>
                    <div class="palette-row">
                        <span class="palette-piece selected" data-piece="empty">â¬œ</span>
                        <span class="palette-hint">Click piece, then click square</span>
                    </div>
                </div>

                <!-- Correction Notice -->
                <div class="correction-notice" id="correctionNotice" hidden>
                    <span class="correction-text">ğŸ“ <span id="correctionCount">0</span> corrections made</span>
                    <button class="btn btn-sm btn-success" id="submitCorrectionsBtn">âœ… Submit for Training</button>
                </div>

                <!-- Deep Analysis Results -->
                <div class="deep-analysis-results" id="deepAnalysisResults" hidden>
                    <h3>ğŸ”¬ Deep Analysis Results</h3>
                    <div class="consensus-status" id="consensusStatus"></div>
                    <div class="games-status" id="gamesStatus"></div>
                    <div class="model-results" id="modelResultsList"></div>
                    <div class="disagreements" id="disagreementsList"></div>
                </div>

                <!-- FEN Display -->
                <div class="fen-container">
                    <div class="fen-status" id="fenStatus"></div>
                    <div class="fen-display">
                        <input type="text" id="fenInput" readonly>
                        <button class="btn btn-icon" id="copyFenBtn" title="Copy FEN">ğŸ“‹</button>
                    </div>
                </div>

                <!-- Analyze on Chess.com -->
                <div class="search-section">
                    <h3>â™Ÿï¸ Analyze on Chess.com</h3>
                    <div class="search-buttons">
                        <a class="btn btn-analyze" id="analyzeWhiteBtn" target="_blank">
                            â¬œ White to Move
                        </a>
                        <a class="btn btn-analyze" id="analyzeBlackBtn" target="_blank">
                            â¬› Black to Move
                        </a>
                    </div>
                </div>

                <!-- Play on Chess.com -->
                <div class="search-section">
                    <h3>ğŸ® Play vs Computer on Chess.com</h3>
                    <div class="search-buttons">
                        <a class="btn btn-play" id="playWhiteBtn" target="_blank">
                            â¬œ Play as White
                        </a>
                        <a class="btn btn-play" id="playBlackBtn" target="_blank">
                            â¬› Play as Black
                        </a>
                    </div>
                </div>

                <!-- Chess.com Search -->
                <div class="search-section" id="findGamesSection">
                    <h3>ğŸ” Find Games on Chess.com</h3>
                    <div class="games-check-row">
                        <button class="btn btn-primary" id="checkGamesBtn">ğŸ” Search</button>
                        <div class="games-check-status" id="gamesCheckStatus" hidden>
                            <span class="checking-text">â³ Checking...</span>
                        </div>
                        <div class="games-found-icons" id="gamesFoundIcons" hidden>
                            <a class="game-found-icon white" id="whiteGameIcon" target="_blank" title="Games found with White to move">
                                <span class="icon">â™”</span>
                                <span class="label">White</span>
                            </a>
                            <a class="game-found-icon black" id="blackGameIcon" target="_blank" title="Games found with Black to move">
                                <span class="icon">â™š</span>
                                <span class="label">Black</span>
                            </a>
                        </div>
                        <div class="no-games-found" id="noGamesFound" hidden>
                            <span>No games found</span>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="result-actions">
                    <button class="btn btn-secondary" id="newScanBtn">
                        ğŸ”„ New Scan
                    </button>
                </div>
            </section>

            <!-- Error State -->
            <section class="card error-card" id="errorSection" hidden>
                <div class="error-icon">âš ï¸</div>
                <p id="errorMessage">An error occurred</p>
                <button class="btn btn-secondary" id="retryBtn">Try Again</button>
            </section>
        </main>

        <!-- Camera Modal -->
        <div class="modal" id="cameraModal" hidden>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ğŸ“¸ Capture Chess Board</h3>
                    <button class="btn btn-icon modal-close" id="closeCameraBtn">âœ•</button>
                </div>
                <div class="camera-container">
                    <video id="cameraVideo" autoplay playsinline muted></video>
                    <div class="camera-guide">
                        <div class="guide-square"></div>
                        <div class="guide-text">Align board here</div>
                    </div>
                </div>
                <div class="camera-status" id="cameraStatus">Initializing camera...</div>
                <div class="camera-controls">
                    <button class="btn btn-secondary" id="switchCameraBtn">ğŸ”„ Switch</button>
                    <button class="btn btn-success btn-large" id="captureBtn" disabled>ğŸ“· Capture</button>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast" hidden></div>

        <!-- Version Info -->
        <div class="version-info" id="versionInfo">Loading version...</div>
    </div>

    <script src="config.js?v=7"></script>
    <script src="app.js?v=7"></script>
</body>
</html>
